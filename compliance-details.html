<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compliance Details - KKFI Admin</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .document-icon.warning { background: #fff8e1; color: #f5a623; }
    .doc-status.warning { color: #f5a623; }
  </style>
</head>
<body>
  <div class="layout">
    <div id="sidebar-container"></div>

    <!-- MAIN CONTENT -->
    <main class="content">
      
      <!-- Header -->
      <div class="applicant-header">
        <a href="compliance.html" class="back-btn">‚Äπ</a>
        <div class="applicant-avatar" id="scholar-initials"></div>
        <div class="applicant-info">
          <h2>
            <span id="scholar-name"></span>
            <span class="status-badge" id="scholar-status"></span>
          </h2>
          <div class="app-id" id="scholar-id"></div>
          <div class="app-date" id="scholar-since"></div>
        </div>
      </div>

      <!-- Compliance Overview -->
      <section class="form-section">
        <h3 class="section-title">Compliance Overview</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>Current GPA</label>
            <input type="text" id="current-gpa" disabled>
          </div>
          <div class="form-group">
            <label>Required GPA</label>
            <input type="text" id="required-gpa" disabled>
          </div>
          <div class="form-group">
            <label>GPA Status</label>
            <input type="text" id="gpa-status" disabled>
          </div>
          <div class="form-group">
            <label>Last Grade Submission</label>
            <input type="text" id="last-submission" disabled>
          </div>
          <div class="form-group">
            <label>KKFI Events Attended</label>
            <input type="text" id="events-attended" disabled>
          </div>
        </div>
      </section>

      <!-- Compliance Requirements -->
      <section class="form-section">
        <h3 class="section-title">Requirements Checklist</h3>
        <div class="documents-grid" id="requirements-checklist">
          <!-- Dynamically populated -->
        </div>
      </section>

      <!-- Event Attendance Tracking -->
      <section class="form-section">
        <h3 class="section-title">Event Attendance</h3>
        <p style="color: #666; font-size: 13px; margin-bottom: 15px;">Attendance is submitted by scholars through their account.</p>
        <table>
          <thead>
            <tr>
              <th>Event Name</th>
              <th>Event Date</th>
              <th>Type</th>
              <th>Attendance</th>
            </tr>
          </thead>
          <tbody id="event-attendance-body">
            <!-- Dynamically populated -->
          </tbody>
        </table>
      </section>

      <!-- Compliance History -->
      <section class="form-section">
        <h3 class="section-title">Compliance History</h3>
        <table>
          <thead>
            <tr>
              <th>Period</th>
              <th>GPA</th>
              <th>Events Attended</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="compliance-history-body">
            <!-- Dynamically populated -->
          </tbody>
        </table>
      </section>

      <!-- Notes Section -->
      <section class="form-section">
        <h3 class="section-title">Notes & Communications</h3>
        <div id="status-notice">
          <!-- Dynamically populated -->
        </div>
        <div class="form-group">
          <label>Add Note</label>
          <textarea rows="4" placeholder="Enter notes about this scholar's compliance..." style="width: 100%; padding: 12px 15px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 14px; resize: vertical;"></textarea>
        </div>
      </section>

      <!-- Action Bar -->
      <div class="action-bar" id="action-bar">
        <!-- Dynamically populated based on status -->
      </div>

    </main>
  </div>
  
  <script src="js/sidebar.js"></script>
  <script src="js/data.js"></script>
  <script>
    // Get scholar ID from URL
    const params = new URLSearchParams(window.location.search);
    const scholarId = params.get('id') || 'LM823748'; // Default to first scholar
    const scholar = getScholarById(scholarId);

    if (scholar) {
      // Populate header
      document.getElementById('scholar-initials').textContent = scholar.initials;
      document.getElementById('scholar-name').textContent = `${scholar.firstName} ${scholar.middleName} ${scholar.lastName}`;
      document.getElementById('scholar-id').textContent = scholar.id;
      document.getElementById('scholar-since').textContent = `Scholar since: ${scholar.scholarSince}`;
      
      // Set status badge
      const statusBadge = document.getElementById('scholar-status');
      statusBadge.textContent = scholar.status === 'non-compliant' ? 'Non-Compliant' : 
                                scholar.status === 'at-risk' ? 'At Risk' : 'Compliant';
      statusBadge.className = `status-badge ${scholar.status}`;

      // Populate compliance overview
      const gpaColor = scholar.compliance.gpa.met ? '#28a745' : '#dc3545';
      document.getElementById('current-gpa').value = scholar.gpa;
      document.getElementById('current-gpa').style.color = gpaColor;
      document.getElementById('current-gpa').style.fontWeight = 'bold';
      
      document.getElementById('required-gpa').value = scholar.requiredGpa;
      
      document.getElementById('gpa-status').value = scholar.gpaStatus;
      document.getElementById('gpa-status').style.color = gpaColor;
      
      document.getElementById('last-submission').value = scholar.lastGradeSubmission;
      if (!scholar.compliance.grades.met) {
        document.getElementById('last-submission').style.color = '#dc3545';
      }
      
      const eventsColor = scholar.compliance.events.met ? '#28a745' : 
                          scholar.status === 'at-risk' ? '#f5a623' : '#dc3545';
      document.getElementById('events-attended').value = scholar.eventsAttended;
      document.getElementById('events-attended').style.color = eventsColor;

      // Populate requirements checklist
      const checklistHtml = `
        <div class="document-card">
          <div class="document-info">
            <h4>Maintain Minimum GPA (${scholar.requiredGpa})</h4>
            <span class="doc-status ${scholar.compliance.gpa.met ? 'complete' : 'error'}">
              Current: ${scholar.gpa} - ${scholar.compliance.gpa.met ? 'Met' : 'Not Met'}
            </span>
          </div>
          <div class="document-icon ${scholar.compliance.gpa.met ? 'complete' : 'error'}">
            ${scholar.compliance.gpa.met ? '‚úì' : '‚úï'}
          </div>
        </div>
        
        <div class="document-card">
          <div class="document-info">
            <h4>Submit Grades Every Semester</h4>
            <span class="doc-status ${scholar.compliance.grades.met ? 'complete' : 'error'}">
              ${scholar.compliance.grades.met ? 'Submitted on ' + scholar.compliance.grades.date : 'Not Submitted - Overdue'}
            </span>
          </div>
          <div class="document-icon ${scholar.compliance.grades.met ? 'complete' : 'error'}">
            ${scholar.compliance.grades.met ? '‚úì' : '‚úï'}
          </div>
        </div>
        
        <div class="document-card">
          <div class="document-info">
            <h4>Attend KKFI Events</h4>
            <span class="doc-status ${scholar.compliance.events.met ? 'complete' : scholar.status === 'at-risk' ? 'warning' : 'error'}">
              ${scholar.compliance.events.attended} of ${scholar.compliance.events.required} attended${!scholar.compliance.events.met ? ' - Missing ' + (scholar.compliance.events.required - scholar.compliance.events.attended) + ' events' : ''}
            </span>
          </div>
          <div class="document-icon ${scholar.compliance.events.met ? 'complete' : scholar.status === 'at-risk' ? 'warning' : 'error'}">
            ${scholar.compliance.events.met ? '‚úì' : scholar.status === 'at-risk' ? '‚ö†' : '‚úï'}
          </div>
        </div>
        
        <div class="document-card">
          <div class="document-info">
            <h4>No Academic Violations</h4>
            <span class="doc-status complete">No violations recorded</span>
          </div>
          <div class="document-icon complete">‚úì</div>
        </div>
      `;
      document.getElementById('requirements-checklist').innerHTML = checklistHtml;

      // Populate event attendance
      let eventHtml = '';
      scholar.eventAttendance.forEach(event => {
        const typeStyle = event.type === 'Required' 
          ? 'background: #e8f5e9; color: #2e7d32;' 
          : 'background: #fff3e0; color: #e65100;';
        
        let attendanceHtml;
        if (event.attended) {
          attendanceHtml = '<span class="status-badge compliant">‚úì Attended</span>';
        } else if (event.type === 'Optional') {
          attendanceHtml = '<span style="color: #999;">‚Äî</span>';
        } else {
          attendanceHtml = '<span class="status-badge non-compliant">‚úó Not Attended</span>';
        }
        
        eventHtml += `
          <tr>
            <td>${event.name}</td>
            <td>${event.date}</td>
            <td><span style="${typeStyle} padding: 3px 10px; border-radius: 12px; font-size: 11px;">${event.type}</span></td>
            <td>${attendanceHtml}</td>
          </tr>
        `;
      });
      document.getElementById('event-attendance-body').innerHTML = eventHtml;

      // Populate compliance history
      let historyHtml = '';
      scholar.complianceHistory.forEach(record => {
        const gpaNum = parseFloat(record.gpa);
        const gpaStyle = gpaNum >= 2.5 ? 'color: #28a745;' : 'color: #dc3545;';
        const eventsStyle = record.status !== 'Compliant' && record.events < 3 ? 'color: #f5a623;' : '';
        
        historyHtml += `
          <tr>
            <td>${record.period}</td>
            <td style="${gpaStyle}">${record.gpa}</td>
            <td style="${eventsStyle}">${record.events}</td>
            <td><span class="status-badge ${record.status.toLowerCase().replace(' ', '-')}">${record.status}</span></td>
          </tr>
        `;
      });
      document.getElementById('compliance-history-body').innerHTML = historyHtml;

      // Populate status notice
      let noticeHtml = '';
      if (scholar.status === 'compliant') {
        noticeHtml = `
          <div style="background: #e8f5e9; border-left: 4px solid #28a745; padding: 15px; border-radius: 0 8px 8px 0; margin-bottom: 15px;">
            <strong style="color: #2e7d32;">Excellent Standing</strong>
            <p style="color: #666; font-size: 13px; margin-top: 5px;">Scholar maintains excellent academic standing and has perfect attendance in all required events.</p>
          </div>
        `;
      } else if (scholar.status === 'at-risk') {
        noticeHtml = `
          <div style="background: #fff8e1; border-left: 4px solid #f5a623; padding: 15px; border-radius: 0 8px 8px 0; margin-bottom: 15px;">
            <strong style="color: #f57f17;">At Risk - Event Attendance</strong>
            <p style="color: #666; font-size: 13px; margin-top: 5px;">Scholar has missed ${scholar.compliance.events.required - scholar.compliance.events.attended} required KKFI events. Academic standing is good but event attendance needs improvement.</p>
          </div>
        `;
      } else {
        noticeHtml = `
          <div style="background: #ffebee; border-left: 4px solid #dc3545; padding: 15px; border-radius: 0 8px 8px 0; margin-bottom: 15px;">
            <strong style="color: #c62828;">Non-Compliant - Multiple Violations</strong>
            <p style="color: #666; font-size: 13px; margin-top: 5px;">Scholar has multiple compliance issues that require immediate attention.</p>
          </div>
          <div style="background: #fff8e1; border-left: 4px solid #f5a623; padding: 15px; border-radius: 0 8px 8px 0; margin-bottom: 15px;">
            <strong style="color: #f57f17;">Warning Notice Sent</strong>
            <p style="color: #666; font-size: 13px; margin-top: 5px;">A final warning was sent regarding compliance violations.</p>
          </div>
        `;
      }
      document.getElementById('status-notice').innerHTML = noticeHtml;

      // Populate action bar based on status
      let actionHtml = '';
      if (scholar.status === 'compliant') {
        actionHtml = `
          <button class="btn btn-outline">üìÑ Generate Compliance Report</button>
          <button class="btn btn-primary">üèÜ Send Commendation</button>
        `;
      } else if (scholar.status === 'at-risk') {
        actionHtml = `
          <button class="btn btn-primary">üìß Send Reminder</button>
          <button class="btn btn-outline">üìÑ Generate Compliance Report</button>
          <button class="btn btn-secondary">‚ö†Ô∏è Issue Warning</button>
        `;
      } else {
        actionHtml = `
          <button class="btn btn-primary">üìß Send Reminder</button>
          <button class="btn btn-outline">üìÑ Generate Compliance Report</button>
          <button class="btn btn-secondary">‚ö†Ô∏è Issue Warning</button>
          <button class="btn btn-danger">üö´ Suspend Scholarship</button>
        `;
      }
      document.getElementById('action-bar').innerHTML = actionHtml;
    }
  </script>
</body>
</html>

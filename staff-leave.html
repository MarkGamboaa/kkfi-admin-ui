<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leave Management - KKFI Admin</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
    }
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    .page-header h1 { margin: 0; }
    .header-actions {
      display: flex;
      gap: 12px;
    }
    .header-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #fff;
      font-size: 14px;
      cursor: pointer;
      color: #333;
      text-decoration: none;
    }
    .header-btn:hover { border-color: #5b5f97; }
    .header-btn svg { width: 16px; height: 16px; }
    .header-btn.primary {
      background: #5b5f97;
      color: #fff;
      border-color: #5b5f97;
    }
    .header-btn.primary:hover { background: #4a4e7a; }
    .header-btn.active { border-color: #5b5f97; background: #f0f1fa; }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: #5b5f97;
      text-decoration: none;
      font-size: 14px;
      margin-bottom: 16px;
    }
    .back-link:hover { text-decoration: underline; }

    /* Stats Cards */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 24px;
    }
    .stat-card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border: 1px solid #eee;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    .stat-icon.pending { background: #fff3e0; color: #ef6c00; }
    .stat-icon.approved { background: #e8f5e9; color: #2e7d32; }
    .stat-icon.on-leave { background: #e3f2fd; color: #1565c0; }
    .stat-info h3 { margin: 0; font-size: 28px; color: #333; }
    .stat-info p { margin: 4px 0 0; color: #888; font-size: 14px; }

    /* Filter Tabs */
    .filter-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
    }
    .filter-tab {
      padding: 8px 16px;
      border: 1px solid #ddd;
      border-radius: 20px;
      background: #fff;
      font-size: 13px;
      cursor: pointer;
      color: #666;
    }
    .filter-tab:hover { border-color: #5b5f97; }
    .filter-tab.active {
      background: #5b5f97;
      color: #fff;
      border-color: #5b5f97;
    }

    .table-card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border: 1px solid #eee;
      overflow: hidden;
    }
    .table-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid #f0f0f0;
    }
    .rows-control {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: #666;
    }
    .rows-select {
      padding: 6px 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }
    .search-box {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #fff;
    }
    .search-box input {
      border: none;
      outline: none;
      font-size: 14px;
      width: 200px;
    }
    .search-box svg { color: #999; width: 16px; height: 16px; }

    .data-table { margin: 0; border-radius: 0; box-shadow: none; }
    .data-table th { 
      background: #fafafa; 
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #666;
    }
    .data-table th, .data-table td { padding: 14px 16px; }

    .staff-cell {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .staff-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #5b5f97;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 13px;
    }

    .leave-type {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 13px;
      background: #f5f5f5;
    }
    .leave-type.vacation { background: #e3f2fd; color: #1565c0; }
    .leave-type.sick { background: #fce4ec; color: #c62828; }
    .leave-type.emergency { background: #fff3e0; color: #ef6c00; }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      white-space: nowrap;
    }
    .status-badge::before {
      content: '';
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }
    .status-badge.pending { background: #fff3e0; color: #ef6c00; }
    .status-badge.pending::before { background: #ef6c00; }
    .status-badge.approved { background: #e8f5e9; color: #2e7d32; }
    .status-badge.approved::before { background: #2e7d32; }
    .status-badge.rejected { background: #ffebee; color: #c62828; }
    .status-badge.rejected::before { background: #c62828; }
    .status-badge.on-leave { background: #e3f2fd; color: #1565c0; }
    .status-badge.on-leave::before { background: #1565c0; }
    .status-badge.cancelled { background: #f5f5f5; color: #666; }
    .status-badge.cancelled::before { background: #666; }

    .action-btn {
      padding: 6px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: #fff;
      font-size: 13px;
      cursor: pointer;
      color: #333;
      margin-right: 4px;
    }
    .action-btn:hover { border-color: #5b5f97; background: #fafaff; }
    .action-btn.approve { border-color: #2e7d32; color: #2e7d32; }
    .action-btn.approve:hover { background: #e8f5e9; }
    .action-btn.reject { border-color: #c62828; color: #c62828; }
    .action-btn.reject:hover { background: #ffebee; }

    .checkbox-cell { width: 40px; }
    .checkbox-cell input { width: 16px; height: 16px; cursor: pointer; }

    /* Filter Dropdown */
    .filter-dropdown { position: relative; display: inline-block; }
    .filter-menu {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 8px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      min-width: 220px;
      max-height: 400px;
      overflow-y: auto;
      z-index: 100;
      padding: 8px 0;
    }
    .filter-menu.show { display: block; }
    .filter-section { padding: 8px 16px; border-bottom: 1px solid #eee; }
    .filter-section:last-child { border-bottom: none; }
    .filter-section-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #888;
      margin-bottom: 8px;
    }
    .filter-menu label {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 6px 0;
      cursor: pointer;
      font-size: 13px;
    }
    .filter-menu label:hover { color: #5b5f97; }
    .filter-menu input[type="checkbox"] { width: 14px; height: 14px; }
    .filter-actions {
      display: flex;
      gap: 8px;
      padding: 12px 16px;
      border-top: 1px solid #eee;
      background: #fafafa;
    }
    .filter-actions button {
      flex: 1;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
    }
    .filter-actions .clear-btn {
      background: #fff;
      border: 1px solid #ddd;
      color: #666;
    }
    .filter-actions .clear-btn:hover { background: #f5f5f5; }
    .filter-actions .apply-btn {
      background: #5b5f97;
      border: 1px solid #5b5f97;
      color: #fff;
    }
    .filter-count {
      background: #5b5f97;
      color: #fff;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 10px;
      margin-left: 4px;
    }

    .form-group { margin-bottom: 16px; }
    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #333;
      font-size: 14px;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      box-sizing: border-box;
    }
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #5b5f97;
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
    }
    .btn-outline {
      background: #fff;
      border: 1px solid #ddd;
      color: #666;
    }
    .btn-outline:hover { background: #f5f5f5; }
    .btn-primary {
      background: #5b5f97;
      border: 1px solid #5b5f97;
      color: #fff;
    }
    .btn-primary:hover { background: #4a4e7a; }
    .btn-danger {
      background: #c62828;
      border: 1px solid #c62828;
      color: #fff;
    }
    .btn-danger:hover { background: #b71c1c; }
  </style>
</head>
<body>
  <div class="layout">
    <div id="sidebar-container"></div>

    <!-- MAIN CONTENT -->
    <main class="content">
      <!-- Back Link -->
      <a href="staff.html" class="back-link">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        Back to Staff Records
      </a>

      <!-- Page Header -->
      <div class="page-header">
        <h1>Leave Management</h1>
        <div class="header-actions">
          <div class="filter-dropdown">
            <button class="header-btn" id="filter-btn">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/></svg>
              Filter
              <span class="filter-count" id="filter-count" style="display: none;">0</span>
            </button>
            <div class="filter-menu" id="filter-menu">
              <div class="filter-section">
                <div class="filter-section-title">Leave Type</div>
                <label><input type="checkbox" name="leaveType" value="vacation" checked> Vacation</label>
                <label><input type="checkbox" name="leaveType" value="sick" checked> Sick Leave</label>
                <label><input type="checkbox" name="leaveType" value="emergency" checked> Emergency</label>
              </div>
              <div class="filter-actions">
                <button class="clear-btn" id="clear-filters">Clear All</button>
                <button class="apply-btn" id="apply-filters">Apply</button>
              </div>
            </div>
          </div>
          <button class="header-btn" id="sort-btn">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"/></svg>
            <span id="sort-label">Sort By Newest</span>
          </button>
          <button class="header-btn primary" onclick="openAddLeaveModal()">+ New Leave Request</button>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-icon pending">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
          </div>
          <div class="stat-info">
            <h3>8</h3>
            <p>Pending Requests</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon approved">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><path d="M22 4L12 14.01l-3-3"/></svg>
          </div>
          <div class="stat-info">
            <h3>45</h3>
            <p>Approved This Year</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon on-leave">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          </div>
          <div class="stat-info">
            <h3>3</h3>
            <p>Currently On Leave</p>
          </div>
        </div>
      </div>

      <!-- Filter Tabs -->
      <div class="filter-tabs">
        <button class="filter-tab active" data-status="all">All Requests</button>
        <button class="filter-tab" data-status="pending">Pending (8)</button>
        <button class="filter-tab" data-status="approved">Approved (45)</button>
        <button class="filter-tab" data-status="rejected">Rejected (5)</button>
        <button class="filter-tab" data-status="on-leave">On Leave (3)</button>
      </div>

      <!-- Table Card -->
      <div class="table-card">
        <div class="table-controls">
          <div class="rows-control">
            <span>Row Per Page</span>
            <select class="rows-select" id="rows-per-page">
              <option value="10">10</option>
              <option value="25">25</option>
              <option value="50">50</option>
            </select>
            <span>Entries</span>
          </div>
          <div class="search-box">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
            <input type="text" id="search-input" placeholder="Search">
          </div>
        </div>

        <table class="data-table">
          <thead>
            <tr>
              <th class="checkbox-cell"><input type="checkbox" id="select-all"></th>
              <th>Leave ID</th>
              <th>Staff</th>
              <th>Leave Type</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Days</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="leave-tbody">
            <!-- Dynamically populated -->
          </tbody>
        </table>
      </div>
    </main>
  </div>

  <!-- Add Leave Modal -->
  <div id="addLeaveModal" onclick="if(event.target === this) closeAddLeaveModal()" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; border-radius: 12px; width: 500px; max-width: 90%;">
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-bottom: 1px solid #eee;">
        <h3 style="margin: 0; font-size: 18px;">New Leave Request</h3>
        <button onclick="closeAddLeaveModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #888;">&times;</button>
      </div>
      <div style="padding: 24px;">
        <form id="addLeaveForm">
          <div class="form-group">
            <label>Staff Member <span style="color: #c62828;">*</span></label>
            <input type="text" id="staffSelect" list="staffList" placeholder="Type to search staff..." required>
            <datalist id="staffList">
              <option value="Juan Santos - Program Manager">
              <option value="Maria Clara Dela Cruz - Finance Officer">
              <option value="Roberto Garcia - HR Coordinator">
              <option value="Angela Villanueva - Administrative Assistant">
              <option value="Pedro Ramos - Scholar Coordinator">
              <option value="Carmen Torres - IT Specialist">
              <option value="Francisco Padilla - Executive Director">
              <option value="Luisa Morales - Communications Officer">
            </datalist>
          </div>
          <div class="form-group">
            <label>Leave Type <span style="color: #c62828;">*</span></label>
            <select id="leaveType" required>
              <option value="">Select leave type</option>
              <option value="vacation">Vacation Leave</option>
              <option value="sick">Sick Leave</option>
              <option value="emergency">Emergency Leave</option>
            </select>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Start Date <span style="color: #c62828;">*</span></label>
              <input type="date" id="startDate" required>
            </div>
            <div class="form-group">
              <label>End Date <span style="color: #c62828;">*</span></label>
              <input type="date" id="endDate" required>
            </div>
          </div>
          <div class="form-group">
            <label>Number of Days</label>
            <input type="number" id="leaveDays" value="0" disabled style="background: #f5f5f5;">
          </div>
          <div class="form-group">
            <label>Reason <span style="color: #c62828;">*</span></label>
            <textarea id="leaveReason" rows="3" placeholder="Provide reason for leave request..." required></textarea>
          </div>
        </form>
      </div>
      <div style="display: flex; justify-content: flex-end; gap: 12px; padding: 16px 24px; border-top: 1px solid #eee; background: #fafafa;">
        <button class="btn btn-outline" onclick="closeAddLeaveModal()">Cancel</button>
        <button class="btn btn-primary" onclick="submitNewLeave()">Submit Request</button>
      </div>
    </div>
  </div>

  <!-- View Leave Modal -->
  <div id="viewLeaveModal" onclick="if(event.target === this) closeViewLeaveModal()" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; border-radius: 12px; width: 500px; max-width: 90%;">
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-bottom: 1px solid #eee;">
        <h3 style="margin: 0; font-size: 18px;">Leave Request Details</h3>
        <button onclick="closeViewLeaveModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #888;">&times;</button>
      </div>
      <div style="padding: 24px;" id="viewLeaveContent">
        <!-- Populated dynamically -->
      </div>
      <div style="display: flex; justify-content: flex-end; gap: 12px; padding: 16px 24px; border-top: 1px solid #eee; background: #fafafa;" id="viewLeaveFooter">
        <button class="btn btn-outline" onclick="closeViewLeaveModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- Reject Modal -->
  <div id="rejectModal" onclick="if(event.target === this) closeRejectModal()" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; border-radius: 12px; width: 420px; max-width: 90%;">
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-bottom: 1px solid #eee;">
        <h3 style="margin: 0; font-size: 18px;">Reject Leave Request</h3>
        <button onclick="closeRejectModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #888;">&times;</button>
      </div>
      <div style="padding: 24px;">
        <p>Are you sure you want to reject this leave request?</p>
        <p><strong>Leave ID:</strong> <span id="rejectLeaveId"></span></p>
        <div class="form-group" style="margin-top: 16px;">
          <label>Reason for Rejection <span style="color: #c62828;">*</span></label>
          <textarea id="rejectReason" rows="3" placeholder="Please provide a reason..." required></textarea>
        </div>
      </div>
      <div style="display: flex; justify-content: flex-end; gap: 12px; padding: 16px 24px; border-top: 1px solid #eee; background: #fafafa;">
        <button class="btn btn-outline" onclick="closeRejectModal()">Cancel</button>
        <button class="btn btn-danger" onclick="confirmReject()">Reject Request</button>
      </div>
    </div>
  </div>

  <script src="js/sidebar.js"></script>
  <script>
    // Leave data
    const leaveData = [
      { id: "LV-2026-018", staffId: "STF-002", name: "Maria Clara Dela Cruz", initials: "MC", type: "vacation", startDate: "2026-02-28", endDate: "2026-03-03", days: 3, status: "pending" },
      { id: "LV-2026-017", staffId: "STF-005", name: "Pedro Ramos", initials: "PE", type: "sick", startDate: "2026-02-24", endDate: "2026-02-25", days: 2, status: "pending" },
      { id: "LV-2026-016", staffId: "STF-008", name: "Luisa Morales", initials: "LB", type: "emergency", startDate: "2026-02-22", endDate: "2026-02-22", days: 1, status: "pending" },
      { id: "LV-2026-015", staffId: "STF-001", name: "Juan Santos", initials: "JR", type: "vacation", startDate: "2026-02-25", endDate: "2026-02-27", days: 3, status: "pending" },
      { id: "LV-2026-014", staffId: "STF-006", name: "Carmen Torres", initials: "CR", type: "vacation", startDate: "2026-02-20", endDate: "2026-02-21", days: 2, status: "approved" },
      { id: "LV-2026-013", staffId: "STF-004", name: "Angela Villanueva", initials: "AL", type: "sick", startDate: "2026-02-18", endDate: "2026-02-19", days: 2, status: "approved" },
      { id: "LV-2026-012", staffId: "STF-003", name: "Roberto Garcia", initials: "RM", type: "vacation", startDate: "2026-02-14", endDate: "2026-02-14", days: 1, status: "approved" },
      { id: "LV-2026-011", staffId: "STF-005", name: "Pedro Ramos", initials: "PE", type: "vacation", startDate: "2026-02-10", endDate: "2026-02-15", days: 6, status: "rejected" },
      { id: "LV-2026-010", staffId: "STF-002", name: "Maria Clara Dela Cruz", initials: "MC", type: "vacation", startDate: "2026-02-17", endDate: "2026-02-21", days: 5, status: "on-leave" },
      { id: "LV-2026-009", staffId: "STF-005", name: "Pedro Ramos", initials: "PE", type: "sick", startDate: "2026-02-18", endDate: "2026-02-20", days: 3, status: "on-leave" }
    ];

    let currentStatusFilter = 'all';
    let sortNewest = true;

    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    function renderLeaves(filteredLeaves) {
      const tbody = document.getElementById('leave-tbody');
      
      if (filteredLeaves.length === 0) {
        tbody.innerHTML = '<tr><td colspan="9" style="text-align:center; padding:40px; color:#888;">No leave requests found</td></tr>';
        return;
      }

      tbody.innerHTML = filteredLeaves.map(leave => {
        const typeClass = leave.type;
        const typeLabel = leave.type === 'vacation' ? 'Vacation' : leave.type === 'sick' ? 'Sick Leave' : 'Emergency';
        const statusClass = leave.status;
        const statusLabel = leave.status === 'pending' ? 'Pending' : 
                           leave.status === 'approved' ? 'Approved' : 
                           leave.status === 'rejected' ? 'Rejected' : 'On Leave';
        
        let actions = '';
        if (leave.status === 'pending') {
          actions = `
            <button class="action-btn approve" onclick="approveLeave('${leave.id}')">Approve</button>
            <button class="action-btn reject" onclick="rejectLeave('${leave.id}')">Reject</button>
          `;
        } else {
          actions = `<button class="action-btn" onclick="viewLeave('${leave.id}')">View</button>`;
        }

        return `
          <tr>
            <td class="checkbox-cell"><input type="checkbox"></td>
            <td>${leave.id}</td>
            <td>
              <div class="staff-cell">
                <div class="staff-avatar">${leave.initials}</div>
                <span>${leave.name}</span>
              </div>
            </td>
            <td><span class="leave-type ${typeClass}">${typeLabel}</span></td>
            <td>${formatDate(leave.startDate)}</td>
            <td>${formatDate(leave.endDate)}</td>
            <td>${leave.days}</td>
            <td><span class="status-badge ${statusClass}">${statusLabel}</span></td>
            <td>${actions}</td>
          </tr>
        `;
      }).join('');
    }

    function applyFilters() {
      let filtered = [...leaveData];
      
      // Status filter from tabs
      if (currentStatusFilter !== 'all') {
        filtered = filtered.filter(l => l.status === currentStatusFilter);
      }
      
      // Search
      const searchTerm = document.getElementById('search-input').value.toLowerCase();
      if (searchTerm) {
        filtered = filtered.filter(l => 
          l.name.toLowerCase().includes(searchTerm) ||
          l.id.toLowerCase().includes(searchTerm)
        );
      }

      // Sort by date
      filtered.sort((a, b) => {
        const dateA = new Date(a.startDate);
        const dateB = new Date(b.startDate);
        return sortNewest ? dateB - dateA : dateA - dateB;
      });

      renderLeaves(filtered);
    }

    // Initial render
    applyFilters();

    // Filter tabs
    document.querySelectorAll('.filter-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        currentStatusFilter = this.dataset.status;
        applyFilters();
      });
    });

    // Search
    document.getElementById('search-input').addEventListener('input', applyFilters);

    // Sort button
    document.getElementById('sort-btn').addEventListener('click', function() {
      sortNewest = !sortNewest;
      document.getElementById('sort-label').textContent = sortNewest ? 'Sort By Newest' : 'Sort By Oldest';
      this.classList.toggle('active', !sortNewest);
      applyFilters();
    });

    // Filter dropdown
    document.getElementById('filter-btn').addEventListener('click', function(e) {
      e.stopPropagation();
      document.getElementById('filter-menu').classList.toggle('show');
      this.classList.toggle('active');
    });

    document.getElementById('clear-filters').addEventListener('click', function() {
      document.querySelectorAll('#filter-menu input[type="checkbox"]').forEach(cb => cb.checked = false);
    });

    document.getElementById('apply-filters').addEventListener('click', function() {
      document.getElementById('filter-menu').classList.remove('show');
      document.getElementById('filter-btn').classList.remove('active');
      applyFilters();
    });

    document.addEventListener('click', function() {
      document.getElementById('filter-menu').classList.remove('show');
      document.getElementById('filter-btn').classList.remove('active');
    });

    document.getElementById('filter-menu').addEventListener('click', e => e.stopPropagation());

    // Select all
    document.getElementById('select-all').addEventListener('change', function() {
      document.querySelectorAll('#leave-tbody input[type="checkbox"]').forEach(cb => cb.checked = this.checked);
    });

    // Calculate days
    document.getElementById('startDate')?.addEventListener('change', calculateDays);
    document.getElementById('endDate')?.addEventListener('change', calculateDays);

    function calculateDays() {
      const start = document.getElementById('startDate').value;
      const end = document.getElementById('endDate').value;
      if (start && end) {
        const diff = Math.ceil((new Date(end) - new Date(start)) / (1000 * 60 * 60 * 24)) + 1;
        document.getElementById('leaveDays').value = diff > 0 ? diff : 0;
      }
    }

    // Modals
    function openAddLeaveModal() {
      document.getElementById('addLeaveModal').style.display = 'flex';
    }

    function closeAddLeaveModal() {
      document.getElementById('addLeaveModal').style.display = 'none';
    }

    function submitNewLeave() {
      alert('Leave request submitted successfully!');
      closeAddLeaveModal();
    }

    function viewLeave(id) {
      const leave = leaveData.find(l => l.id === id);
      if (!leave) return;
      
      const typeLabel = leave.type === 'vacation' ? 'Vacation' : leave.type === 'sick' ? 'Sick Leave' : 'Emergency';
      const statusLabel = leave.status === 'pending' ? 'Pending' : 
                         leave.status === 'approved' ? 'Approved' : 
                         leave.status === 'rejected' ? 'Rejected' : 'On Leave';

      document.getElementById('viewLeaveContent').innerHTML = `
        <div class="staff-cell" style="margin-bottom: 20px;">
          <div class="staff-avatar" style="width: 48px; height: 48px; font-size: 16px;">${leave.initials}</div>
          <div>
            <strong style="font-size: 16px;">${leave.name}</strong>
            <div style="color: #888; font-size: 13px;">${leave.staffId}</div>
          </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div><label style="color: #888; font-size: 12px;">Leave ID</label><p style="margin: 4px 0;">${leave.id}</p></div>
          <div><label style="color: #888; font-size: 12px;">Leave Type</label><p style="margin: 4px 0;"><span class="leave-type ${leave.type}">${typeLabel}</span></p></div>
          <div><label style="color: #888; font-size: 12px;">Start Date</label><p style="margin: 4px 0;">${formatDate(leave.startDate)}</p></div>
          <div><label style="color: #888; font-size: 12px;">End Date</label><p style="margin: 4px 0;">${formatDate(leave.endDate)}</p></div>
          <div><label style="color: #888; font-size: 12px;">Days</label><p style="margin: 4px 0;">${leave.days} day(s)</p></div>
          <div><label style="color: #888; font-size: 12px;">Status</label><p style="margin: 4px 0;"><span class="status-badge ${leave.status}">${statusLabel}</span></p></div>
        </div>
      `;
      document.getElementById('viewLeaveModal').style.display = 'flex';
    }

    function closeViewLeaveModal() {
      document.getElementById('viewLeaveModal').style.display = 'none';
    }

    function approveLeave(id) {
      if (confirm('Approve leave request ' + id + '?')) {
        alert('Leave request approved!');
        location.reload();
      }
    }

    let currentRejectId = '';
    function rejectLeave(id) {
      currentRejectId = id;
      document.getElementById('rejectLeaveId').textContent = id;
      document.getElementById('rejectModal').style.display = 'flex';
    }

    function closeRejectModal() {
      document.getElementById('rejectModal').style.display = 'none';
      document.getElementById('rejectReason').value = '';
    }

    function confirmReject() {
      const reason = document.getElementById('rejectReason').value;
      if (!reason) {
        alert('Please provide a reason for rejection.');
        return;
      }
      alert('Leave request rejected.');
      closeRejectModal();
      location.reload();
    }

    // Close modals on outside click
    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', function(e) {
        if (e.target === this) this.style.display = 'none';
      });
    });
  </script>
</body>
</html>
